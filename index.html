<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>Sistema de Captura de Planas de Hidalgo</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  
  <style>
    /* ------------------------------------------------ */
    /* ESTILOS BASE                                     */
    /* ------------------------------------------------ */
    :root {
      --color-fondo-pagina: #2c3e50;
      --color-fondo-form: #34495e;
      --color-primary: #e74c3c;
      --color-primary-hover: #c0392b; 
      --color-secondary: #3498db;
      --color-secondary-hover: #2980b9; 
      --color-danger: #9b59b6;
      --color-danger-hover: #8e44ad; 
      --color-light-text: #ecf0f1;
      --color-dark-text: #2c3e50;
      --color-input-bg: #ecf0f1;
      --color-alerta-vacio: #f1c40f;
      --radius: 5px;
    }
    body {
      font-family: 'Roboto', sans-serif;
      margin: 0;
      padding: 20px;
      background-color: var(--color-fondo-pagina);
      color: var(--color-light-text);
      line-height: 1.6;
    }
    .container { max-width: 1000px; margin: 0 auto; }
    h1 {
      text-align: center;
      margin-bottom: 30px;
      color: var(--color-light-text);
      border-bottom: 2px solid var(--color-primary);
      padding-bottom: 10px;
    }
    /* ‚Ä¶ aqu√≠ siguen todos tus estilos de formulario, tabla y responsive ‚Ä¶ */
  </style>
</head>
<body>
<div class="container">
  <h1>Captura de Planas de Peri√≥dicos</h1>

  <div id="errorCargaCSV" class="error-carga" style="display: none;">
      ‚ö†Ô∏è Error al cargar archivos CSV (Medio, Recurso, etc.). ‚ö†Ô∏è
      <br>
      Esto sucede si abre el archivo HTML directamente desde su computadora (`file:///...`) debido a restricciones de seguridad del navegador (CORS).
      <br><br>
      SOLUCI√ìN: Suba este archivo HTML a GitHub Pages o use un servidor web local.
  </div>
  <form id="formCaptura" onsubmit="event.preventDefault()">
    <!-- Campos: Usuario, Fecha, Medio, Titular, Recurso, Dependencia, Organismo, Tema, Estatus -->
    <!-- Cada campo con su input, bot√≥n de sugerencias y checkbox de bloqueo -->
    <!-- ‚Ä¶ aqu√≠ va todo tu formulario tal como lo ten√≠as ‚Ä¶ -->

    <div class="button-group-form">
      <button type="button" id="btnGuardar"><i class="fa-solid fa-floppy-disk"></i> Guardar</button>
      <button type="button" id="btnEliminarNota" onclick="borrarNota()"><i class="fa-solid fa-trash-can"></i> Borrar Nota</button>
      <button type="button" id="btnLimpiar" onclick="limpiarFormulario()"><i class="fa-solid fa-broom"></i> Limpiar</button>
    </div>
  </form>

  <div class="button-group-table">
    <button id="btnExportar" onclick="exportarCSV()"><i class="fa-solid fa-download"></i> Exportar CSV</button>
    <button id="btnBorrarTodo" onclick="borrarTodo()"><i class="fa-solid fa-skull-crossbones"></i> BORRAR TODO</button>
  </div>
  
  <hr>

  <h2>Registros Capturados</h2>
  
  <table id="tablaNotas">
    <thead>
      <tr>
        <th>#</th><th>Usuario</th><th>Fecha</th><th>Medio</th><th>Titular</th>
        <th>Recurso editorial</th><th>Dependencia</th><th>Organismo</th>
        <th>Tema</th><th>Estatus</th><th>Acciones</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>
<script>
    // ======================================================================
    // üü¢ CONFIGURACI√ìN DE URLS DE GITHUB (FORMATO RAW) üü¢
    // ======================================================================
    const urls = {
        medio: "https://raw.githubusercontent.com/thelonious9/captura-portadas/main/Medio.csv",
        recurso: "https://raw.githubusercontent.com/thelonious9/captura-portadas/main/Recurso.csv", // ‚Üê corregido
        dependencia: "https://raw.githubusercontent.com/thelonious9/captura-portadas/main/Dependencia.csv",
        tema: "https://raw.githubusercontent.com/thelonious9/captura-portadas/main/Tema.csv",
        estatus: "https://raw.githubusercontent.com/thelonious9/captura-portadas/main/Estatus.csv"
    };

    // ======================================================================
    // üåü CONSTANTES GLOBALES Y ESTRUCTURA DE DATOS üåü
    // ======================================================================
    const camposDeDatos = ['ordenCaptura','usuario','fecha','medio','titular','recurso','dependencia','organismo','tema','estatus'];
    const encabezadosTabla = { ordenCaptura:'#', usuario:'Usuario', fecha:'Fecha', medio:'Medio', titular:'Titular', recurso:'Recurso editorial', dependencia:'Dependencia', organismo:'Organismo', tema:'Tema', estatus:'Estatus' };
    const camposObligatorios = camposDeDatos.filter(c => c !== 'ordenCaptura' && c !== 'tema');

    let notas = [];
    let nextOrdenCaptura = 1;
    let filaEnEdicion = null;
    let dependenciaMap = {}; 
    let listasAutocompletado = {}; 

    // ======================================================================
    // ---------------------- Carga y Procesamiento CSV ---------------------
    // ======================================================================
    async function cargarCSV(url) {
        try {
            const response = await fetch(url + '?t=' + Date.now()); 
            if (!response.ok) throw new Error(`Fallo en la carga del CSV (Status: ${response.status})`); 
            return await response.text();
        } catch (error) {
            console.error(`Error al cargar ${url}:`, error);
            document.getElementById("errorCargaCSV").style.display = 'block';
            throw error;
        }
    }

    async function cargarMapa(url) {
        const text = await cargarCSV(url);
        const filas = text.trim().split('\n').slice(1).filter(l => l.trim());
        const map = {};
        const claves = new Set();
        filas.forEach(line => {
            const [clave, valor] = line.split(',').map(item => item.trim().replace(/^"|"$/g, ''));
            if (clave && valor) {
                if (!map[clave]) map[clave] = new Set();
                map[clave].add(valor);
                claves.add(clave);
            }
        });
        const mapArrays = {};
        Array.from(claves).sort((a, b) => a.localeCompare(b, 'es')).forEach(k => {
            mapArrays[k] = Array.from(map[k]).sort((a, b) => a.localeCompare(b, 'es'));
        });
        return { claves: Array.from(claves).sort((a, b) => a.localeCompare(b, 'es')), map: mapArrays };
    }

    async function cargarLista(url) {
        const text = await cargarCSV(url);
        const filas = text.trim().split('\n').slice(1).filter(l => l.trim());
        const lista = filas.map(line => line.split(',')[0].trim().replace(/^"|"$/g, ''));
        return Array.from(new Set(lista)).filter(Boolean).sort((a, b) => a.localeCompare(b, 'es'));
    }

    // ‚Ä¶ aqu√≠ siguen tus funciones de guardarNotas, cargarNotas, alternarBloqueo, setupAutocomplete, renderizarTabla, etc. ‚Ä¶
</script>
</body>
</html>